%-------------------------------------------------------------------------------
% configuration
%-------------------------------------------------------------------------------
%
% \file        configuration.tex
% \library     Documents
% \author      Chris Ahlstrom
% \date        2021-01-18
% \update      2021-01-18
% \version     $Revision$
% \license     $XPC_GPL_LICENSE$
%
%     Provides the configuration information.
%
%-------------------------------------------------------------------------------

\section{Seq66 Configuration}
\label{sec:configuration}

   \textsl{Seq66} configuration has become a lot more elaborate.
   Fortunately, most of the configuration is well documented with-in the
   \textsl{Seq66} "man" page and in the configuration files themselves.
   Therefore, this new discussion will be less prolix than it was for
   \textsl{Sequencer64}.  Here are the topics to discuss:

   \begin{itemize}
      \item \textbf{Command-line Options}
      \item \textbf{'rc' File}
      \item \textbf{'usr' File}
      \item \textbf{'ctrl' File}
      \item \textbf{'mutes' File}
      \item \textbf{'drums' File}
      \item \textbf{'palette' File}
      \item \textbf{'playlist' File}
   \end{itemize}

   After the first run of \textsl{Seq66},
   it will generate a set of configration files in the default
   \textsl{configuration} directory, with names dependent on the version of
   \textsl{Seq66} being run:

   \begin{verbatim}
      /home/user/.config/seq66/qseq66.rc
      /home/user/.config/seq66/qseq66.usr
      /home/user/.config/seq66/qseq66.ctrl
      /home/user/.config/seq66/qseq66.mutes
      /home/user/.config/seq66/qseq66.drums
      /home/user/.config/seq66/qseq66.playlist
   \end{verbatim}

   For \textsl{Microsoft Windows}, the default basename of the files is
   \texttt{qpseq66}, and the default configuration directory is

   \begin{verbatim}
        C:/Users/user/AppData/Local/seq66/
   \end{verbatim}

   When running \textsl{Seq66} from the \textsl{Non Session Manager}
   (see \sectionref{sec:sessions}),
   the configuration directory is automatically set to something like

   \begin{verbatim}
      /home/user/NSM Sessions/MySession/seq66.nRSIQ/config
   \end{verbatim}

   There is no palette file by default, but the user can create one.
   The color palettes are discussed in \sectionref{sec:palettes}.

   These files contain the the data for remote MIDI control, computer keyboard
   control, MIDI clock, JACK transport, and a many other settings.

   \textsl{Seq66} \textsl{always} overwrites the most of these files upon
   exiting.  One must therefore quit \textsl{Seq66} before making
   manual modifications to these files.

   Some of the settings can be modified in the \textbf{Edit / Preferences}
   dialog, or overridden from the command line.

\subsection{Configuration File Commonalities}
\label{subsec:configuration_file_commonalities}

   All of the \textsl{Seq66} configuration files have the following in common:

   \begin{itemize}
      \item \textbf{[Seq66] Section}
      \item \textbf{[comments] Section}
      \item \textbf{Numeric Settings}
      \item \textbf{Boolean Settings}
      \item \textbf{Variables}
      \item \textbf{Stanzas}
   \end{itemize}

   Generally, each configuration file has its own specific set
   of sections, each section-name being enclosed in square brackets in a very
   strict format:  No spaces inside the square brackets.  Sections are looked up
   by this name, including the square brackets, and the name must be exact.

\subsubsection{[Seq66] Section}
\label{subsec:configuration_common_seq66_section}

   This section is generally just informational.  At a minimum, it holds two
   variables:

   \begin{itemize}
      \item \texttt{config-type}.  This value indicates the type of the file,
      such as "ctrl" or 'rc'.
      \item \texttt{version}.  This value indicates the version of the file.
      Currently, it is not used, but once \textsl{Seq66} solidifies,
      it can be used to make adjustments for changes in configuration when
      reading older versions of files.
   \end{itemize}

   This section may also contain additional "global"
   variables specific to a given \texttt{config-type}.

\subsubsection{[comments] Section}
\label{subsec:configuration_common_comments_section}

   This section is also informational, but the user can edit this section to
   include information describing the purpose of the file.  For example, a 'ctrl'
   file for a \textsl{Novation Launchpad} might describe the purpose of this
   file.  The comments stop at the first blank (not even spaces) line.  To skip a
   line in the comment, put a single space character on the blank line.

\subsubsection{Numeric Settings}
\label{subsec:configuration_common_numeric_settings}

   Numeric settings consist of a line containing one or more numbers, usually
   preceded by an explanatory comment, and followed by a standard script comment.

   \begin{verbatim}
      3    # grid_style
   \end{verbatim}

\subsubsection{Boolean Settings}
\label{subsec:configuration_common_boolean_settings}

   Boolean settings are the same as numerical settings, but have only
   two values: "0" or "1".

   \begin{verbatim}
      0        # flag to record incoming data by channel
   \end{verbatim}

\subsubsection{Variables}
\label{subsec:configuration_common_variables}

   Variable are a new style of value setting, and can encompass not only booleans
   and numeric values, but string values, which may correspond to enumerated
   values in the source code.  These values are specified by a section-name plus
   variable-name pair.

   \begin{verbatim}
      [mute-group-flags]
      save-mutes-to = both
      mute-group-rows = 4
      mute-group-columns = 8
      mute-group-selected = -1
      groups-format = bin
   \end{verbatim}

\subsubsection{Stanzas}
\label{subsec:configuration_common_stanzas}

   A stanza in a \textsl{Seq66} configuration file consists of some data at the
   beginning, a set of values bracketed by square brackets, and some optional
   data at the end.  The values inside the square brackets are numeric, and can
   be in decimal format, sometimes hexadecimal format, or in binary "0/1" format.

   \begin{verbatim}
      0 "1" [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ]  # Loop 0
      1 "q" [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ]  # Loop 1
      2 "a" [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ]  # Loop 2
      3 "z" [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ]  # Loop 3
   \end{verbatim}

\subsection{Command Line}
\label{subsec:configuration_command_line}

   Command-line options are well-described in the \textsl{Seq66} "man" page.
   Here, we will present a brief note about each option, and, where applicable, a
   reference to the corresponding configuration file option.
   Here is the basic command line:

   \begin{verbatim}
       qseq66 [options list] [MIDI filename]
   \end{verbatim}

   \optionline{-h}{--help}
      Display a list of all command-line options, then exit.

   \optionline{-v}{--version}
      Display the program version, then exit.

   \optionline{-H}{--home [directory]}
      Change the "home" configuration directory from \texttt{\$HOME.config/seq66}
      The configuration files are loaded from or saved to the specified directory.

   \optionline{-b}{--bus [buss]}
      Modifies the output buss number on \textsl{all} tracks when a MIDI file is
      read.  Useful for testing or quick-and-dirty setup.

   \optionline{-q}{--ppqn [ppqn]}
      Supports modifying the PPQN value of Seq66, which is
      defaults to a value of 192.  This setting
      is written into the MIDI file when it is saved.
      The PPQN value can range from 32 to 19200, or
      be set to 0 to use the PPQN from the loaded file.

      \configref{usr}{user-midi-settings}{midi\_ppqn}.

   \optionline{-L}{--lash}
      If LASH support is compiled into the program, this option
      enables it.  Deprecated.
      See \texttt{usr: [user-session] session}.

      \configref{usr}{user-session}{session}

   \optionline{-m}{--manual-ports}
      \textsl{Seq66} won't attach the system's existing ALSA or JACK MIDI ports.
      Instead, it will create is own set of \textsl{virtual}
      input and output busses/ports.  The default number of port is 1 for input,
      and 16 for output, but these values can be changed in the 'rc' file.

      \configref{rc}{manual-ports}{flag for manual/virtual ports}

   \optionline{-a}{--auto-ports}
      \textsl{Seq66} will automatically attach to the system's existing
      ALSA/JACK ports.

      \configref{rc}{manual-ports}{flag for manual/virtual ports}

   \optionline{-r}{--reveal-ports}
      \textsl{Seq66} will show the names of the ALSA/JACK ports that the system
      defines, rather than the names defined in the 'usr' configuration file.

   \optionline{-R}{--hide-ports}
      \textsl{Seq66} will show the names of the ALSA port that the 'user'
      configuration file define, rather than the names defined by ALSA.

      \configref{rc}{reveal-ports}{flag for reveal ports}

      \configref{usr}{user-midi-bus-definitions}{number of user-defined busses}

   \optionline{-A}{--alsa}
      \textsl{Seq66} will run with ALSA, even if JACK is running.
      This options is "sticky" (they are saved).

   \optionline{-t}{--jack-midi}
      \textsl{Seq66} will run with JACK, which is the default is JACK is
      running.

      \configref{rc}{jack-transport}{with\_jack\_midi}

   \optionline{-s}{--show-midi}
      Dumps incoming MIDI to the screen.

   \optionline{-p}{--priority}
      Runs at higher priority with a FIFO scheduler.

   \optionline{N/A}{--pass-sysex}
      Passes any incoming SYSEX messages to all outputs.
		Not yet fully implemented.

   \optionline{-k}{--show-keys}
      Prints pressed key value.

   \optionline{-K}{--inverse}
      Changes the color palette for the sequence editor and performance editor
      piano rolls.  Also note that the palette is highly configurable.

      \configref{palette}{palette}{inverse}

   \optionline{-X}{--playlist [filename]}
      This option loads the given file-name as a play-list file.
      See \sectionref{sec:playlist}.

      \configref{rc}{playlist}{name}

      \configref{playlist}{playlist}{full}

   \optionline{-j}{--jack-transport}
      \textsl{Seq66} will sync to JACK transport.

      \configref{rc}{jack-transport}{with\_jack\_transport}

   \optionline{-J}{--jack-master}
      \textsl{Seq66} will try to be JACK master.

      \configref{rc}{jack-transport}{with\_jack\_master}

   \optionline{-C}{--jack-master-cond}
      JACK master will fail if there is already a master.

      \configref{rc}{jack-transport}{with\_jack\_cond}

   \optionline{-M}{--jack-start-mode [x]}
      When \textsl{Seq66} is synced to JACK, the following play modes
      are available: 0 = live mode; and 1 = song mode, the default.

      \configref{rc}{jack-transport}{song\_start\_mode}

   \optionline{-U}{--jack-session-uuid [uuid]}
      Set the UUID for the JACK session.

   \optionline{-u}{--user-save}
      Save the 'usr' configuration file when exiting.
      Normally, it is saved only if not present in the configuration directory,
      so as not to get stuck with temporary settings such as the --bus option.

      \configref{rc}{auto-option-save}{auto-save-options-on-exit}

   \optionline{-f}{--rc filename}
      Use a different 'rc' configuration file.
      It must be a file in the user's \texttt{\$HOME/.config/seq66}
      directory or the directory specified by the \texttt{--home} option.
      The \texttt{.rc} extension is added if necessary.

   \optionline{-F}{--usr filename}
      Use a different 'usr' configuration file.  Similar to the \texttt{--rc}
      option.

   \optionline{-c}{--config basename}
      Use a different configuration file base name for the 'rc' and 'usr'
      files.  For example, one can specify a full configuration for "testing",
      for "jack", or for "alsa", to set up
      \texttt{testing.rc} and \texttt{testing.usr},
      \texttt{jack.rc} and \texttt{jack.usr},
      \texttt{alsa.rc} and \texttt{alsa.usr}.

   \optionline{-o}{--option opvalue}
      Provides additional options, since the application is running out of
      single-character options.  The \texttt{opvalue} set supported is:
      \begin{itemize}
         \item \texttt{daemonize} and \texttt{no-daemonize}.
            \index{daemonize}
            Makes the \texttt{seq66cli} application fork to the background, or
            \index{no-daemonize}
            makes the \texttt{seq66cli} application
            run in the foreground so that console output can be seen.
         \item \texttt{log=filename.log}.
            \index{log}
            Reroutes standard error and standard
            output messages to the given log-file.  This file is located in
            the configuration directory.
            If this file is present, additional log information is appended.
            The default log-file name is specified in the
            \texttt{[user-options]} section of the 'usr' file.
         \item \texttt{sets=8x8}.
            \index{variset}
            This option, informally known as "variset", allow some changes in
            the set size and layout from the default 4x8 = 32 sets layout.
            Consider this option to be experimental. Expect problems.
            To save these options to the 'usr' file, add the
            \texttt{--user-save} option to the command line.
            In that file, the options modified are \texttt{mainwnd\_rows} and
            \texttt{mainwnd\_cols}.
         \item \texttt{scale=WxH}.
            \index{scaling}
            This option scales the main window by the given factors,
            ranging from 0.75 to 3.0.
         \item \texttt{mutes=value}. Specifies the saving of mute-groups
            to the 'mutes' file, 'midi' file, or 'both' files.
         \item \texttt{virtual=o,i}. Set up the manual-ports option with 'o'
            output ports and 'i' input ports.
      \end{itemize}

      Many of the above options are including in the relevant configuration
      files.  We will point to them in the future.

\subsection{'rc' File}
\label{subsec:configuration_rc}

   \begin{verbatim}
      /home/user/.config/seq66/qseq66.rc
   \end{verbatim}

   The 'rc' configuration file has undergone a lot of changes, including
   off-loading the keyboard control, MIDI control, and mutes control sections
   into their own files, and adding a few "variable" settings.
   Rather than repeating information already present in the self-documenting
   'rc' file, we will summarize the settings and refer the reader to the sample
   files for more information.

   The 'rc' file adds these \texttt{[Seq66]} options to the common
   data for all configuration files:

   \begin{verbatim}
      verbose = false
      sets-mode = normal
      port-namng = short
   \end{verbatim}

   \texttt{verbose} is the same as the \texttt{--verbose} command-line option,
   except that, if set to "true", it affects every invocation of \textsl{Seq66}.

   The \texttt{sets-mode} option determines if sets are muted when going to the
   next play-screen ('normal'), while 'autoarm' will automatically
   unmute the next set.  The 'additive' options keeps the previous
   set unmuted when moving to the next set.  These are options requested by
   users.

  The port-naming values are 'short' or 'long'.  The short style
  just shows the port number and short port name; the long style
  shows all the numbers and the long port name.

\subsubsection{'rc' File / MIDI Control}
\label{subsubsec:configuration_rc_midi_control}

   \index{[midi-control-file]}
   \textsl{Seq66} offloads the MIDI control sections to a separate file.
   Simply move or create
   the \texttt{[midi-control]} section to a separate file in
   the \textsl{Seq66} configuration directory, and add the following
   snippet:

   \begin{verbatim}
      [midi-control-file]
      "qseq66.ctrl"          # contains a whole [midi-control] section
   \end{verbatim}

   As with the 'rc' file, the 'ctrl' file is rewritten upon exit.
   For the details of the 'ctrl' file, see
   \sectionref{subsec:configuration_ctrl}.

\subsubsection{'rc' File / Mute Groups}
\label{subsubsec:configuration_rc_mute_groups}

   \begin{verbatim}
      [midi-group-file]
      "qseq66.mutes"         # contains a whole [mute-groups] section
   \end{verbatim}

   The mutes-groups sections is written on exit dependent on the
   \texttt{save-mutes-to} option in the mute-groups file.

\subsubsection{'rc' File / Color Palette}
\label{subsubsec:configuration_rc_color_palette}

   \begin{verbatim}
      [palette-file]
      1       # palette_active
      "qseq66.palette"
   \end{verbatim}

   The only need for a palette file is when the user is not satisfied with the
   default palette for the patterns, inverse colors, or hatching for some pattern
   piano roll items.  There is a button to save the current/default palette for
   later modification in the \textbf{Edit / Preferences / Display} tab.

\subsubsection{'rc' File / Note Mapper}
\label{subsubsec:configuration_rc_note_mapper}

   \begin{verbatim}
      [note-mapper]
      1
      "qseq66.drums"
   \end{verbatim}

   This file can be used transform the existing drum (non-transposable) tracks
   into another set of drum tracks.  A lot of work has been done in the past
   with non-General-MIDI instruments (particularly consumer instruments like the
   \textsl{Yamaha PSS-780}.
   This option is useful for transformation older MIDI files into GM format.

\subsubsection{'rc' File / MIDI-Clock Section}
\label{subsec:configuration_rc_midi_clock}

   \index{[midi-clock]}
   The MIDI Clock fields contain the clocking state from the last 
   time \textsl{Seq66} was run, and their status, and their names.
   Turn off the clock with a 0, or on
   with a 1 (which means to send
   \textbf{MIDI Song Position}, and
   \textbf{MIDI Continue} if
   starting after tick 0), or on with positioning with a 2, which sends
   \textbf{MIDI Start}
   and then begins clocking after the position reaches a modulo of the
   \textbf{Clock Start Modulo value)}.  Luckily, the user-interface makes it
   easy to select the desire value, and has tool-tips to instruct the user.
   This section has entries for each MIDI output buss.

   This configuration item is represented in the
   \textbf{Edit / Preferences / MIDI Clock} tab.

   \begin{verbatim}
      [midi-clock]
      5    # number of MIDI clocks (output busses)
      0 0    "[0] 14:0 Midi Through Port-0"
      1 0    "[1] 128:0 TiMidity port 0"
      2 0    "[2] 128:1 TiMidity port 1"
      . . .
   \end{verbatim}

\subsection{'rc' File / MIDI Clock Mod Ticks}
\label{subsec:configuration_midi_cmt}

   \index{[midi-clock-mod-ticks]}
   This configuration item is the same as the
   \textbf{Clock Start Modulo} option described in
   \paragraphref{paragraph:menu_file_options_midi_clock}.

   \begin{verbatim}
      [midi-clock-mod-ticks]
      64
      0   # flag to record incoming data by channel
   \end{verbatim}

   The record-flag is kind of an outcast.  Not sure why it is here,
   something to rectify later.

\subsection{'rc' File / MIDI-Meta-Events Section}
\label{subsec:configuration_midi_meta_events}

   \index{[midi-meta-events]}
   The new MIDI Meta events section is the start of additional options
   supporting meta events as normal events in \textsl{Seq66}.
   This section defines just one feature of MIDI meta-event handling at present.
   Normally, tempo events are supposed to occur in the first track (pattern 0).
   But one can move this track elsewhere to accomodate one's existing body of
   tunes.  If affects where tempo events are recorded.  The default value is 0,
   the maximum is 1023.  A pattern must exist at this number for it to work.
   \index{tempo-track-number}

   \begin{verbatim}
      [midi-meta-events]
      10      # tempo_track_number
   \end{verbatim}

   As per the MIDI specification, the first track (track 1 in track
   numbering, or pattern 0 in \textsl{Seq66} numbering) is \textsl{the}
   official track for certain MIDI meta events, such as
   \textbf{Set Tempo} and
   \textbf{Time Signature}.
   However, to accommodate existing tunes and their set
   arrangement, we allow the user to
   and change the tempo track to another pattern.

\subsection{'rc' File / Keyboard Control Section}
\label{subsec:configuration_keyboard_control}

   The keyboard control has been merged into the MIDI control and been moveed
   into the 'ctrl' file.
   There is no longer any user-interface to change the
   keyboard control, for two reasons:
   (1) It is pretty easy to read, understand, and edit the 'ctrl' file, and
   (2) There are many more controls in \textsl{seq66}, and creating a
   user-interface to edit them would not be worth the effort.
   We suspect most users will be happy enough with the default settings,
   and users of internationaly keyboards will find the 'ctrl' file easy enough
   to edit with a programmer's editor.
        
\subsection{'rc' File / JACK Transport}
\label{subsec:configuration_jack_transport}

   This section holds the settings for both JACK transport and for native JACK
   MIDI mode.

   \index{[jack-transport]}
   The JACK Transport options are also command-line options.
   See \sectionref{subsec:configuration_command_line}.

   \begin{verbatim}
      [jack-transport]
      0   # with_jack_transport
      0   # with_jack_master
      0   # with_jack_master_cond
      0   # song_start_mode
      0   # with_jack_midi
   \end{verbatim}

   These options are described well in the 'rc' file.

   Please note that only the JACK transport options are set to make sense, no
   matter what the user specifies.
   Also note that JACK transport is separately configurable from
   JACK MIDI, and each uses a different JACK client internally.
   We might combine them at some point, if necessary.

\subsection{'rc' File / MIDI Input}
\label{subsec:configuration_midi_input}

   \index{[midi-input]}
   This configuration item is represented in the
   \textbf{MIDI Input} tab in the \textbf{Edit / Preferences}.
   The first number is a line count, and would equal the number of
   supported input ports.
   After that, this 'rc' entry here has two variables;
   the first is the port number,
   and the second number indicates whether it is disabled (0), or enabled (1).
   The next lines show the input busses present on the system (normally).

   \begin{verbatim}
      [midi-input]
      2   # number of MIDI busses
      0 1    "[0] 0:1 system:announce"
      1 0    "[1] 14:0 Midi Through Port-0"
   \end{verbatim}

   Again, see the 'rc' file itself for more information.

\subsection{'rc' File / Manual ALSA Ports}
\label{subsec:configuration_manual_ports}

   The name of this setting is a bit of a misnomer in a couple of ways:

   \index{ports!virtual}
   \index{ports!manual}
   \begin{enumerate}
      \item It actually refers to the usage of \textsl{virtual} MIDI ports.
         These are ports that are set up by the application so that other
         devices or applications can connect to the MIDI application.
         Where the "manual" idea comes in is that the user can manually choose
         the connections to be made.
      \item This option is not just for ALSA.  It can also be used when
         running in native JACK mode, to support
         virtual JACK ports that can be connected manually (e.g. in the
         \textsl{QJackCtl} application.)
   \end{enumerate}

   \index{[manual-ports]}
   \begin{verbatim}
      [manual-ports]
      0   # flag for manual (virtual) ALSA or JACK ports
      8   # number of manual/virtual output ports
      4   # number of manual/virtual input ports
   \end{verbatim}

   \index{--auto-ports}
   The opposite of \texttt{--manual-ports} is \texttt{--auto-ports},
   which is the normal mode of running \textsl{Seq66}.
   In this mode, system MIDI input/output devices are discovered and
   automatically connected.

   It will create port namess as per the settings in the 'usr' configuration
   file's \texttt{user-midi-bus-definitions} and \texttt{user-midi-bus-N}
   sections.  These definitions can be used by JACK for connection, and these
   definitions can be used to specifically rename the ports that exist in the
   system.
   This option is misleading if one wants to have access to the
   actual ALSA/JACK ports that exist on the system.
   The next option gets around that issue.

\subsection{'rc' File / Reveal ALSA Ports}
\label{subsec:configuration_reveal_ports}

   This option applies to both ALSA and JACK.

   \index{[reveal-ports]}
   \begin{verbatim}
      [reveal-ports]
      1   # flag for reveal ALSA ports
   \end{verbatim}

   \index{jack!reveal-ports}
   Turning on the reveal-ports option is necessary if one
   wants to see the actual port names defined by the system.
   It ignores the settings in the 'usr' configuration file's
   \texttt{user-midi-bus-definitions} and \texttt{user-midi-bus-N} sections.
   If this option is turned on, the definitions in the
   'usr' configuration file are \textsl{not} read from that file.

\subsection{'rc' File / Interaction Method}
\label{subsec:configuration_interaction}

   \begin{verbatim}
      1   # allow_mod4_mode
      1   # allow_snap_split
      1   # allow_click_edit
   \end{verbatim}

   The \texttt{Mod4} ("Windows" key) option is still available, but no longer
   necessary.  Also removed is the option for the "fruity" option
   of \textsl{Seq24}.
   It will be added if there is a clamor for it.

   \index{[allow-snap-split]}
   \index{new!snap-split}
   This option comes from the \textsl{seq32} project.  It allows for
   pattern-splitting in the Song editor at snap points, rather than just
   at the middle of the pattern.

   \index{[allow-click-edit]}
   \index{new!click-edit}
   This option allows one to enable/disable the ability to double-click
   in a pattern slot in the main window to bring it up for editing.
   This can interfere with a live performance where muting/unmuting come fast
   enough to be seen as a double-click.

\subsection{'rc' File / Auto Option Save}
\label{subsec:configuration_auto_rc_save}

   \index{[auto-option-save]}
   This item determines if the 'rc' configuration file (and other files)
   is saved
   upon exit of \textsl{Seq66}.  The legacy behavior is to save it,
   which can sometimes be inconvenient when one is just trying out some
   command-line options.

   \begin{verbatim}
      [auto-option-save]
      0     # auto-save-options-on-exit support flag
   \end{verbatim}

\subsection{'rc' File / Last Used Directory}
\label{subsec:configuration_last_used_dir}

   The following item refers to the last directory in which one opened or
   saved a MIDI file.

   \index{[last-used-dir]}
   \begin{verbatim}
      [last-used-dir]
      /home/ahlstrom/Home/ca/mls/git/seq66/contrib/midi/
   \end{verbatim}

\subsection{'rc' File / Recent Files}
\label{subsec:configuration_recent_files}

   The following item preserves a list of the last few MIDI files loaded.
   It is not filled when a MIDI file is loaded via a play-list.
   The first number is the count of recent-files.
   The second number is a boolean, set to "1" if the most-recent file
   should be loaded when \textsl{Seq66} starts.
   This option is useful as part of restoring a session.

   \index{[recent-files]}
   \begin{verbatim}
      [recent-files]
      2 1
      /home/user/Home/ca/mls/git/seq66-alternate/contrib/midi/2Bars.midi
      contrib/midi/b4uacuse-seq24.midi
   \end{verbatim}

\subsection{'rc' File / Play-List}
\label{subsec:configuration_playlist}

   This feature is recent.
   It provides a configured set of named play-lists in a play-list file,
   and a flag to activate it.
   Having a playlist makes it easy to load song after song from a pre-determined
   list.
   
   \index{[playlist]}
   \begin{verbatim}
      [playlist]
      0     # playlist_active, 1 = active, 0 = do not use it
      /home/ahlstrom/.config/seq66/sample.playlist
   \end{verbatim}

   See \sectionref{sec:playlist}.
   It describes the setup, layout, and usage of a
   \textsl{Seq66} playlist file containing one or more playlists.

\subsection{'ctrl' File}
\label{subsec:configuration_ctrl}

   Like \textsl{Seq24}, \textsl{Seq66} provides a way to control the
   application to some extent via a MIDI controller, such as a MIDI keyboard or
   a MIDI pad device.  The current section describes this feature;
   additional resources and ideas can be found at \url{linuxaudio.org}
   (\cite{midicontrol}).

   This file provides settings for keyboard control, MIDI control, and for
   specifying MIDI output to reflect \textsl{automation} commands.
   The name of this file is specfied in the 'rc' file as noted earlier.

\subsubsection{'ctrl' File / MIDI Control Settings}
\label{subsubsec:configuration_ctrl_midi_control_settings}

   \begin{verbatim}
      /home/user/.config/seq66/qseq66.usr
   \end{verbatim}

   This file offloads the control settings from the 'rc' file, for a more
   flexible setup. It starts with the sections common to all \textsl{Seq66}
   configuration files.  The first unique section defines some useful settings
   using the new variables feature of the configuration.  Look at the sample or
   generated file to see the layout of these items.

   \begin{itemize}
      \item \texttt{load-key-controls}.
         Generally, this should always be set to "true".
      \item \texttt{load-midi-controls}.
         This one could plausibly disabled, but for live performance will
         certainly be set to "true".
      \item \texttt{control-buss}.
         The control-buss value ranges from 0 to the maximum buss provided by
         the hardware on the system. If set, then only that buss will be allowed
         to send MIDI control.  A value of 255 or 0xff means any buss can send
         MIDI control.
      \item \texttt{midi-enabled}.
         If set to "true", then the MIDI controls will be used.
         It can be set to "false", while keeping the configuration in place
         for later usage.
      \item \texttt{button-offset}.
         This item provides a way to move a set of input controls (e.g. from a
         \textsl{Launchpad Mini}) to a different area of the input control
         device.  Not yet supported.
      \item \texttt{button-rows}.
         Indicates the rows of the input control grid.
         Still in progress.
      \item \texttt{button-columns}.
         Indicates the columns of the input control grid.
         Still in progress.
   \end{itemize}

\subsubsection{'ctrl' File / Loop Control}
\label{subsubsec:configuration_ctrl_loop_control}

   The loop-control group consists of 32 lines (0 to 31), one for each
   pattern slot shown in the patterns panel.
   It provides a way to control the arming/disarming (muting/unmuting) of
   each pattern shown in the patterns panel.
   It consolidates the keyboard and MIDI control settings into one table.

   Note that the main window shows the \textsl{active} screen-set.
   These MIDI controls affect the \textsl{active} screen-set.

   This block of matrix elements, numbered from 0 to 31,
   represent control functions (toggle, mute, unmute) for the 32 patterns
   of the active screen-set.
   These 32 rows correspond to the hot-keys assigned in
   the \textbf{File / Options / Keyboard / Control keys [keyboard-group]} 
   configuration panel.

   \index{[loop-control]}
   The MIDI control section begins with the following "INI"-style
   group marker tag, followed by one stanza-line per loop:

   \begin{verbatim}
      [loop-control]
      0 "1" [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ]  # Loop 0
   \end{verbatim}

   The first number is an index number, starting at 0.  It indicates what
   loop the control line will affect.
   The numbers in the leftmost brackets define a \textsl{toggle} filter;
   the numbers in the middle brackets define an \textsl{on} filter;
   the numbers in the rightmost brackets define an \textsl{off} filter.
   The numbers inside each set of brackets define six values that set up the
   control.  The layout of each filter inside the brackets is as follows:

      \textbf{[OPR INV STAT D1 D2min D2max]}

   \begin{itemize}
      \item \textbf{OPR} = \textbf{on/off}
      \item \textbf{INV} = \textbf{inverse}
      \item \textbf{STAT} = \textbf{MIDI status byte} (channel ignored) 
      \item \textbf{D1} = \textbf{data1}
      \item \textbf{D2min} = \textbf{data2 min}
      \item \textbf{D2max} = \textbf{data2 max}
   \end{itemize}

   If \textbf{OPR (on/off)} is set to 1, it will match the incoming MIDI
   against the \textbf{STAT (MIDI status byte)} pattern.
   and perform the action (on/off/toggle) if the data
   falls in the range specified.  All values are in decimal.

   The \textbf{INV (inverse)} field will make the pattern perform the opposite
   action (\textsl{off} for \textsl{on}, \textsl{on} for \textsl{off}) if the
   data falls outside the specified range.  This is cool because one can map
   several sequences to a knob or fader.

   The \textbf{STAT (MIDI status byte)} field is a MIDI status byte number in
   decimal or hexadecimal notation.
%  The channel nybble of this byte is ignored.
   One can look up the possible status values up in the MIDI messages tables;
   the relevant data can be found at \cite{midicontroltable}.
%  As the channel on which the events are sent is ignored,
%  it is sufficient to use the values for channel 1; that is, 0.

   The last three fields describe the range of data that will match.  The
   \textbf{D1 (data1)} field provides the actual MIDI event message number to
   detect, in decimal.  This item could be a Note On/Off event or a
   Control/Mode change event, for example.

   The \textbf{D2min (data2 min)} field is the minimum value of the event for
   the filter to match. For Note On/Off events, this would be the velocity
   value, for example.

   The \textbf{D2max (data2 max)} field is the maximum value of the event for
   the filter to match.

%  This set of values is explained below.

   For each pattern, we can set up MIDI events to turn a 
   pattern on, off, or to toggle it.

   The MIDI control setup resembles a matrix.  This matrix is divided into a
   number of sections depending on the overall functionality of the MIDI
   controls in the section:

\subsubsection{'ctrl' File / Mute-Group Control}
\label{subsubsec:configuration_ctrl_mute_group_control}

   \index{mute-group control}
   This section provides controls for 32 groups of mutes.
   A group is a set of patterns that can toggle their playing state
   together.  Every group contains all 32 sequences in the active screen set.
   So, this part of the MIDI Control section is used for muting and unmuting
   (and toggling) a group of patterns using a keystroke or MIDI control.
   The definitions are in the same format as the loop-control section.

   \begin{verbatim}
      [mute-group-control]
       0 "!" [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ] [ 0 0 0x00 0 0 0 ]  # Mute 0
   \end{verbatim}

   All this section does is set up the controls to be used; the actual
   mute-group patters are defined in a 'mutes' configuration file.

\subsubsection{'ctrl' File / Automation Control}
\label{subsubsec:configuration_midi_ctrl_automation}

   This section provides ways to control \textsl{Seq66} push-button controls
   from a keyboard or from a MIDI device.
   These entries control
   \textsl{Seq66} actions like changing the BPM value, screen-set,
   record, solo, etc.
   
   Each item in this group consists of one line.  Each line
   specifies a MIDI event that can cause a given
   \textsl{Seq66} user-interface operation to occur.
   These items are easy to view in the 'ctrl' configuration file,
   in the \texttt{[automation-control]} section.

\paragraph{Automation / BPM Up and Down}
\label{paragraph:configuration_midi_ctrl_bpmupdn}

   These controls increment or decrement the beats-per-minute setting, as if
   the up- or down-arrow has been clicked, or the up- or down-arrow key pressed,
   in the BPM user-interface control.
   This increment is the
   \index{bpm!step increment}
   \index{usr!step increment}
   "step increment" which defaults to 1, but can be modified by
   changing the "bpm\_step\_increment" value in the 'usr'
   configuration file.

%  See \sectionref{subsec:usr_file_user_midi_settings}.

\paragraph{Automation / Screen-Set Up and Down}
\label{paragraph:configuration_midi_ctrl_ssupdn}

   The Screen-Set Up MIDI control increments to the next screen-set. 
   Once the screen-set has been altered, mute-groups and other
   actions apply to that screen set.

   Similarly, the Screen-Set Up MIDI control decrements to the previous
   screen-set.

\paragraph{Automation / Mod Replace}
\label{paragraph:configuration_midi_ctrl_modrep}

   The Mod Replace MIDI control sets the "replace" status flag.
   Then, when the user manually clicks a pattern slot,
   that pattern is unmuted, and all the rest are muted.
   Thus, this MIDI control is kind a of "Solo" function.
   It works whether in "Live" or "Song" mode.

\paragraph{Automation / Mod Snaphot}
\label{paragraph:configuration_midi_ctrl_modsnap}

   The Mod Snapshot MIDI control causes the playing statuses of all active
   (i.e. having data) patterns to be saved.  When turned off, the
   original playing status is restored.  Thus, two MIDI events
   need to be allocated to this functionality.

\paragraph{Automation / Mod Queue}
\label{paragraph:configuration_midi_ctrl_modqueue}

   The Mod Queue MIDI control sets up the "queue" status flag.
   Then, when the user manually clicks a pattern slot,
   that pattern is queued, and will play at the next cycle of the
   pattern.

   Here is an example from \cite{midicontrol}, which shows how to set up
   the "Sustain" control-change event to queue or un-queue a sequence:
   The \textsl{Akai MPK Mini} has a Sustain button and we can set the
   Sustain MIDI event (with MIDI status byte 176 [0xB0] to represent a
   Controller event, and control/mode change number 64 [0x40] to
   represent the Sustain or Pedal control) up as the queue modifier in
   the \texttt{mod queue} entry:

   \begin{verbatim}
   # mod queue
   #    Toggle                 On                      Off
   70 [0   0   0   0   0   0  ] [1   0   176 64 127 127] [1   0  176 64  0  0]
   #   OPR INV STA D1  mn mx     OPR INV STA D1 mn  mx   OPR INV STA D1  mn mx
   #                                      ^  ^                    ^  ^
   #                                      |  |                    |  |
   #                                      |   ----Sustain------------
   #                                       -------Control Change--
   \end{verbatim}

   So when the Sustain button is held down, and one presses one of the pads
   on the \textsl{MPK Mini}, the corresponding sequence gets queued.

\paragraph{Automation / Mod Mute Group}
\label{paragraph:configuration_midi_ctrl_modgmute}

   The Mod Group Mute MIDI control sets up a "mute group".
   More to come on this one,
   see \sectionref{subsec:patterns_panel_top}.

   This control sets an internal "mode-group" flag on.

   When activated, \textsl{Seq66} loops through all of the 32
   screen-sets, and through the active pattern in each screen-set, and
   sets each pattern as muted or unmuted, depending on the saved mute state.

\paragraph{Automation / Mod Mute Group}
\label{paragraph:configuration_midi_ctrl_modgmute}

   The Mod Group Learn MIDI control sets up a "group learn".
   However, as the group-learn key is a modifier key that needs to
   be held, we're not quite sure how this works with MIDI control.

   This control sets two internal flags on : "mode-group" and "group-learn".
   The first flag indicates that we will be handling mute-groups.
   The second flag indicates that we are learning these mute-groups,
   effectively recording the current status of all the patterns in all of the
   screen-sets.

   \index{L button}
   Note that this control corresponds to the "L" button in the main window
   user-interface.
   \index{keys!Ctrl-L}
   \index{keys!l}
   It can also be accessed by the hard-wired hot-keys, \texttt{l} and
   \texttt{Ctrl-L}.

\paragraph{Automation / Screen-Set Play}
\label{paragraph:configuration_midi_ctrl_ssplay}

This MIDI control sets the playing screen-set.

\subsubsection{Automation / More}
\label{subsubsec:configuration_midi_ctrl_automationex}

   Many additional control items were requested by users, to control
   additional features of the application.
   See the 'ctrl' file sample for more information.

\subsubsection{'ctrl' File / MIDI Control for Patterns}
\label{subsubsec:configuration_ctrl_midi_control_out}

   This control can be used, for example, to emulate the \textsl{Ableton Live
   row control} functionality.  Here is a sample that uses the lowest range of
   MIDI notes to control the muting and unmuting of patterns:

   \begin{verbatim}
      # Pattern-group section:
      0 [0 0 0 0 0 0]   [1 0 144  0   0 127]  [1 0 128    0   0 127]
   \end{verbatim}

   Observer that MIDI On (144) and Off (128) events appear four times for
   each note value of 0, 1, 2, and 3.  Each note value thus controls four
   patterns -- one whole row in a 4x8 pattern.  When note 0 is pressed,
   patterns 0, 4, 8, and 12 turn on.  When note 0 is released, they turn off.

\subsubsection{'ctrl' File / MIDI Control Output}
\label{subsubsec:configuration_ctrl_midi_control_out}

   This section provides a way to have a MIDI device show the status
   of the patterns that are active.

   \begin{verbatim}
      [midi-control-out-settings]
   \end{verbatim}

   The first section sets up some general settings.

   \begin{itemize}
      \item \texttt{set-size}.
         Provides the set size.  More information to dig for.
      \item \texttt{output-buss}.
         Indicates where automation-display controls are to be send.
      \item \texttt{midi-enabled}.
         If set to "true", then the MIDI control outputs will be used.
         It can be set to "false", while keeping the configuration in place
         for later usage.
      \item \texttt{button-offset}.
         This item provides a way to move a set of output controls (e.g. from a
         \textsl{Launchpad Mini}) to a different area of the output control
         device.  Not yet supported.
      \item \texttt{button-rows}.
         Indicates the rows of the output control grid.
         Still in progress.
      \item \texttt{button-columns}.
         Indicates the columns of the output control grid.
         Still in progress.
   \end{itemize}

   \begin{verbatim}
      [midi-control-out]
      0 [0 0 0x00 0 0] [0 0 0x00 0 0] [0 0 0x00 0 0] [0 0 0x00 00]
   \end{verbatim}

   The first number is the pattern number of the pattern whose armed/muted
   status is to be shown.

\subsection{'mutes' File}
\label{subsubsec:configuration_ctrl_mute_group_control}

   The mute-in group onsists of 32 lines (32 to 63), one for each
   pattern box shown in the Pattern window.
   It provides a way to control the mute groups.
   A group is a set of sequences that can arm their playing state
   together; every group contains all 32 sequences in the
   \textsl{active} screen-set.

   This section is delimited by the \texttt{[mute-group]} construct.
   It controls 32 groups of mutes in the same way as defined for
   \texttt{[midi-control]}. A group is set of sequences that can toggle their
   playing state together.  Every group contains all 32 sequences in the
   active screen set.

   \begin{verbatim}
      [mute-group]
      1024    # group mute value count
      0 [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0]
      1 [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0]
      2 [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0]
      ...      ...               ...               ...               ...
      31 [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0]
   \end{verbatim}

   The initial number, 1024 is probably the total count of 32 x 32 sequences.
   In this group are the definitions of the state of the 32 sequences
   in the playing screen set when a group is selected.
   Each set of brackets defines a group:
   
   \begin{verbatim}
      [state of the first 8 sequences] [second 8] [third 8] [fourth 8]
   \end{verbatim}

   After the list of sequences and their MIDI events, one can 
   set \textsl{Seq66} to handle MIDI events and change some more settings
   in \texttt{seq66.rc}.

   What is the different between the \textbf{mute-in group}
   section and the \textbf{mute group} section?  The former defines the MIDI
   control values that can affect the muting of a group, while the latter
   specifies the patterns that are part of a group.

\subsection{'ctrl' File}
\label{subsec:configuration_ctrl}

\subsection{'drums' File}
\label{subsec:configuration_drums}

\subsection{'palette' File}
\label{subsec:configuration_palette}

\subsection{'usr' File}
\label{subsec:configuration_usr}

\subsection{'playlist' File}
\label{subsec:configuration_playlist}


%-------------------------------------------------------------------------------
% vim: ts=3 sw=3 et ft=tex
%-------------------------------------------------------------------------------
